<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
    <title>IMAGE EDITOR</title>
  </head>
  <body>
    <div id="app">
      <header>
        <div>IMAGE EDITOR</div>
      </header>
      <main>
        <div class="canvas__controller">
          <button>undo</button>
          <button>redo</button>
          <button>download</button>
        </div>
        <div class="canvas__input">
          <label for="file__input">Select File</label>
          <input
            id="file__input"
            type="file"
            v-on:change="onChangeFileInput($event)"
          />
        </div>
        <div class="canvas__wrapper">
          <canvas ref="originImageLayer" width="850" height="500"></canvas>
          <canvas ref="blurredImageLayer" width="850" height="500"></canvas>
          <canvas
            ref="dragLayer"
            v-on:mousedown="onMouseDown"
            v-on:mousemove="onMouseMove"
            v-on:mouseup="onMouseUp"
            width="850"
            height="500"
          ></canvas>
        </div>
      </main>
    </div>
  </body>
  <script>
    new Vue({
      el: "#app",
      data() {
        return {
          imageSource: "",
          isDragging: false,
          startX: 0,
          startY: 0,
          width: 0,
          height: 0,
          blurryAreas: [],
        };
      },
      methods: {
        onChangeFileInput(e) {
          const file = e.target.files[0];

          if (!file) return;

          this.imageSource = URL.createObjectURL(file);
        },
        onMouseDown(e) {
          this.startX = e.offsetX;
          this.startY = e.offsetY;
        },
        onMouseMove(e) {
          this.width = e.offsetX - this.startX;
          this.height = e.offsetY - this.startY;
        },
        onMouseUp(e) {
          const canvas = this.$refs.blurredImageLayer;
          const context = canvas.getContext("2d");

          if (this.width !== 0 && this.height !== 0) {
            this.blurryAreas = [
              ...this.blurryAreas,
              {
                x: this.startX,
                y: this.startY,
                width: this.width,
                height: this.height,
                blurryImage: context.getImageData(
                  this.startX,
                  this.startY,
                  this.width,
                  this.height
                ),
              },
            ];
          }
        },
      },
      watch: {
        startX() {
          console.log(this.startX);
        },
        startY() {
          console.log(this.startY);
        },
        blurryAreas() {
          console.log(this.blurryAreas);
        },
        imageSource() {
          const canvas = this.$refs.originImageLayer;
          const context = canvas.getContext("2d");

          const image = new Image();
          image.src = this.imageSource;

          image.onload = () => {
            context.drawImage(image, 0, 0, canvas.width, canvas.height);
          };
        },
      },
    });
  </script>
</html>
